<!DOCTYPE html>
<html data-bs-theme="dark">
  <head>
    <title>VR Game Editor & Viewer</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Custom styles -->
    <link rel="stylesheet" href="./styles.css" />
    <link rel="stylesheet" href="./editorStyles.css" />
    <!-- A-Frame and other scripts -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-extras/dist/aframe-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Your scripts -->
    <script type="module" src="./GameEngine/gameEngine.js" defer></script>
    <script type="module" src="./GameEditor/spriteEditor.js" defer></script>
    <script type="module" src="./GameEditor/mapEditor.js" defer></script>
    <script type="module" src="./GameEditor/gameEditor.js" defer></script>
  </head>
  <body>
    <!-- Editor Section -->
    <div id="editorContainer" style="display: none">
      <div id="editorScrollContainer">
        <h1>Game Editor</h1>
        <p>Editor functionalities go here...</p>
        <button id="exportProjectBtn">Export Project</button>
        <input
          type="file"
          id="importGameData"
          accept=".json"
          style="display: none"
        />
        <button id="importProjectBtn">Import Project</button>

        <div id="mapEditorSection" class="section">
          <div class="section-header">
            <h2>Map Editor</h2>
            <span>Hide/Show</span>
          </div>
          <div class="section-content">
            <div class="map-controls">
              <div class="control-group">
                <label for="sceneSelector">Scene:</label>
                <select id="sceneSelector">
                  <!-- Scenes will be added dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="layerSelector">Layer:</label>
                <select id="layerSelector">
                  <!-- Added dynamically -->
                </select>
              </div>

              <div class="control-group">
                <label for="spriteSelector">Sprite:</label>
                <select id="spriteSelector">
                  <!-- Added dynamically -->
                </select>
              </div>
            </div>

            <div class="map-actions">
              <button class="btn-editor" id="loadMap">
                <i class="bi bi-download"></i> Load Map
              </button>
              <button class="btn-editor" id="saveMap">
                <i class="bi bi-save"></i> Save Map
              </button>
            </div>

            <div class="mapGrid"></div>

            <div class="map-footer">
              <button class="btn-editor" id="generateMapCode">
                <i class="bi bi-code-square"></i> Generate Code
              </button>
              <button class="btn-editor danger" id="resetMapGrid">
                <i class="bi bi-trash"></i> Reset
              </button>
              <textarea id="mapCode" rows="10" readonly></textarea>
            </div>
          </div>
        </div>

        <div id="spriteEditorSection" class="section">
          <div class="section-header">
            <h2>Sprite Editor</h2>
            <span>Hide/Show</span>
          </div>
          <div class="section-content">
            <div class="sprite-editor-controls">
              <div class="control-group tools">
                <label>Tools</label>
                <div class="tool-buttons">
                  <button class="btn-editor" id="pen">
                    <i class="bi bi-pencil-fill"></i> Pen
                  </button>
                  <button class="btn-editor" id="eraser">
                    <i class="bi bi-eraser-fill"></i> Eraser
                  </button>
                  <button class="btn-editor" id="fill">
                    <i class="bi bi-paint-bucket"></i> Fill
                  </button>
                  <input type="color" id="colorPicker" value="#000000" />
                </div>
              </div>

              <div class="control-group sprite-info">
                <label>Sprite Properties</label>
                <div class="sprite-properties">
                  <input
                    type="text"
                    id="spriteIdInput"
                    placeholder="Sprite ID"
                  />
                  <select id="spriteEditorSelector">
                    <!-- Options added dynamically -->
                  </select>
                  <select id="spriteTypeSelector">
                    <option value="block">Block</option>
                    <option value="billboard">Billboard</option>
                  </select>
                </div>
                <div class="sprite-options">
                  <label class="checkbox-label">
                    <input type="checkbox" id="spriteCollisionCheckbox" />
                    Collision
                  </label>
                  <div class="scene-select">
                    <label>Change Scene:</label>
                    <select id="changeSceneSelector">
                      <option value="">None</option>
                      <!-- Scene options added dynamically -->
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <div class="sprite-editor-workspace">
              <div class="grid-container">
                <div class="grid"></div>
                <div class="grid-preview"></div>
              </div>

              <div class="sprite-actions">
                <button class="btn-editor" id="loadSprite">
                  <i class="bi bi-download"></i> Load Sprite
                </button>
                <button class="btn-editor" id="saveSprite">
                  <i class="bi bi-save"></i> Save Sprite
                </button>
                <button class="btn-editor" id="generateCode">
                  <i class="bi bi-code-square"></i> Generate Code
                </button>
                <button class="btn-editor danger" id="resetGrid">
                  <i class="bi bi-trash"></i> Reset
                </button>
              </div>
            </div>

            <textarea id="spriteCode" rows="10" readonly></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Viewer Section -->
    <div id="gameContainer">
      <a-scene xr-mode-ui="enabled: true">
        <!-- <a-entity id="player" position="0 1.5 0">
          <a-camera></a-camera>
          <a-entity id="leftHand" oculus-touch-controls="hand: left"></a-entity>
          <a-entity
            id="rightHand"
            oculus-touch-controls="hand: right"
          ></a-entity>
        </a-entity>
        <a-light type="ambient" color="#FFF"></a-light> -->
      </a-scene>
    </div>

    <!-- Button Container -->
    <div class="button-container">
      <button id="enterVRButton">Enter VR</button>
      <button id="toggleButton">Switch to Editor View</button>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var enterVRButton = document.getElementById("enterVRButton");
        var sceneEl = document.querySelector("a-scene");

        enterVRButton.addEventListener("click", function () {
          if (sceneEl.is("vr-mode")) {
            console.log("Already in VR mode");
          } else {
            sceneEl.enterVR();
          }
        });
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const toggleButton = document.getElementById("toggleButton");
        const editorContainer = document.getElementById("editorContainer");
        const gameContainer = document.getElementById("gameContainer");

        let isInEditorMode = false;

        toggleButton.addEventListener("click", () => {
          isInEditorMode = !isInEditorMode;
          editorContainer.style.display = isInEditorMode ? "block" : "none";
          gameContainer.style.display = isInEditorMode ? "none" : "block";
          toggleButton.textContent = isInEditorMode
            ? "Switch to Game View"
            : "Switch to Editor View";
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const headers = document.querySelectorAll(".section-header");

        headers.forEach((header) => {
          header.addEventListener("click", () => {
            const content = header.nextElementSibling;
            if (content.style.display === "none" || !content.style.display) {
              content.style.display = "block";
            } else {
              content.style.display = "none";
            }
          });
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const importProjectBtn = document.getElementById("importProjectBtn");
        const importGameDataInput = document.getElementById("importGameData");

        // Add an event listener to the button
        importProjectBtn.addEventListener("click", function () {
          // Trigger the click event on the hidden file input
          importGameDataInput.click();
        });

        importGameDataInput.addEventListener("change", function () {
          const file = this.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              // Here you can parse the JSON and do what's needed with it
              const importedGameData = JSON.parse(e.target.result);
              console.log(importedGameData);
              // Update your game's data with the imported data
            };
            reader.readAsText(file);
          }
        });
      });
    </script>
  </body>
</html>
